<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard - Schede Clienti</title>
    <link rel="icon" href="/favicon.ico" type="image/x-icon" />
    <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/style.css">
<link rel="stylesheet" href="/css/dashboard-layout.css">
<link rel="stylesheet" href="./css/hair-scanner.css" />


<!-- FullCalendar CSS -->
<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/main.min.css" rel="stylesheet" />

<!-- FullCalendar JS -->
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/main.min.js"></script>

<!-- Il tuo script dashboard -->


</head>
<body>

<main class="container dashboard-main">
    <table class="header-table">
    <tr>
        <td class="logo-cell">
            <img src="img/logo1.jpg" alt="Logo Quality Hair" class="page-logo">
        </td>
        <td class="greeting-cell">
            <h2 id="summary-greeting">üëã Caricamento...</h2>
            <div id="summary-aforisma" class="aforisma-widget">
                <p id="aforisma-frase">‚Äú...‚Äù</p>
                <footer id="aforisma-autore"></footer>
            </div>
        </td>
        <td class="weather-cell">
            <div id="summary-weather" class="weather-widget">
                <span id="weather-text">Meteo non disponibile</span>
                <img id="weather-icon" src="" alt="" style="display: none;">
            </div>
			
			
			
			
			
			
        </td>
    </tr>
</table>

	
  
    <!-- ============================================= -->
    <!-- ========= NUOVA GRIGLIA A 3 COLONNE ========= -->
    <!-- ============================================= -->
    <div class="dashboard-layout-grid-3-col">

        <!-- === COLONNA SINISTRA === -->
 <div class="dashboard-column">
            
   
				
            <!-- PANNELLO CERCA CLIENTE -->
            <div class="panel dashboard-panel">
            
                <input type="text" id="search-input" placeholder="Nome, Cognome o Soprannome" class="input-field" />
                <button id="search-button" class="btn btn-primary">Cerca cliente</button>
            </div>

            <!-- PANNELLO NUOVO CLIENTE -->
			<!-- NUOVA STRUTTURA COLLASSABILE -->
				<div class="panel dashboard-panel collapsible-panel closed">
				<div class="collapsible-header">
				<h2 class="panel-title">Nuovo Cliente</h2>
				<span class="collapsible-arrow">‚ñº</span>
				</div>
				<div class="collapsible-content">
					<!-- Il form ora √® qui dentro -->
				<input type="text" id="new-client-name" placeholder="Nome" required class="input-field" />
				<input type="text" id="new-client-surname" placeholder="Cognome" required class="input-field" />
				<input type="text" id="new-client-nickname" placeholder="Soprannome (opzionale)" class="input-field" />
				<input type="email" id="new-client-email" placeholder="Email (opzionale)" class="input-field" />
				<input type="tel" id="new-client-phone" placeholder="Telefono (opzionale)" class="input-field" />
				<input type="text" id="new-client-tags" placeholder="Tag (es: VIP, Allergia Tinta)" class="input-field" />
				<button id="add-new-client-button" class="btn btn-primary">Aggiungi Cliente</button>
				</div>
				</div> 
				
				         <!-- PANNELLO RIEPILOGO MATTUTINO -->
<div class="summary-panel">
    <div class="summary-metrics">
        <div id="widget-sospesi" class="metric-widget clickable">
            <div class="metric-icon">üö®</div>
            <div class="metric-value" id="sospesi-count">...</div>
            <div class="metric-label">Clienti in Sospeso</div>
        </div>
        <div id="widget-buoni" class="metric-widget clickable">
            <div class="metric-icon">üéÅ</div>
            <div class="metric-value" id="buoni-count">...</div>
            <div class="metric-label">Buoni Attivi</div>
        </div>
        <!-- NUOVO WIDGET SCORTE BASSE -->
        <div id="widget-scorte" class="metric-widget clickable">
            <div class="metric-icon">üì¶</div>
            <div class="metric-value" id="scorte-count">0</div>
            <div class="metric-label">Prodotti in Esaurimento</div>
        </div>
    </div>
</div>
				
				

<!-- === CLIENTE DEL MESE === -->
<section class="client-of-month-section" id="client-of-month-section">
    <div class="client-of-month-card">
        <div class="crown-icon">üëë</div>
        <h2 class="client-of-month-title">CLIENTE DEL MESE</h2>
        
        <div class="client-of-month-info">
            <div class="client-avatar-large" id="client-of-month-avatar">
                <div class="client-avatar-initials">?</div>
            </div>
            <div class="client-details">
                <div class="client-name" id="client-of-month-name">Calcolo in corso...</div>
                <div class="client-since" id="client-of-month-since"></div>
            </div>
        </div>
        
        <div class="client-stats">
            <div class="stat">
                <span class="number" id="stat-visits">0</span>
                <span class="label">Visite</span>
            </div>
            <div class="stat">
                <span class="number" id="stat-spent">‚Ç¨0</span>
                <span class="label">Speso</span>
            </div>

    </div>
</section>

				

</div>

        <!-- === COLONNA CENTRALE === -->
        <div class="dashboard-column">
		            <button id="apri-mappa-btn" class="btn btn-primary">Quality Live</button>
		
		
            <!-- PANNELLO APPUNTAMENTI DI OGGI -->
			
            <div class="panel dashboard-panel">
                
                <ul class="appointments-list" id="lista-appuntamenti">
                    <li class="appointment-item loading">Caricamento in corso...</li>
                </ul>
            </div>  



	
 
        </div>

        <!-- === COLONNA DESTRA === -->
        <div class="dashboard-column">
		   
			
			
			
			
			
			

			
			
            
            <!-- PANNELLO STRUMENTI E LINK -->
            <div class="panel dashboard-panel collapsible-panel closed">
    <div class="collapsible-header">
        <h2 class="panel-title">Strumenti</h2>
        <span class="collapsible-arrow">‚ñº</span>
    </div>
    <div class="collapsible-content">
        <div class="tools-grid">


            <button onclick="window.open('https://calendar.google.com/calendar/u/0/r/week', '_blank')" class="btn btn-primary">Google Calendar</button>
             <a href="/calendario" class="btn btn-primary">Agenda Settimanale</a>

            <button id="apri-impostazioni-btn" class="btn btn-primary">Impostazioni e Gestione</button>

        </div>
    </div>
</div>



			<!-- PANNELLO CLIENTI DA CONTATTARE (ORA COLLASSABILE) -->
<div class="panel dashboard-panel collapsible-panel closed">
    <div class="collapsible-header">
        <h2 class="panel-title">Clienti in Ritardo</h2>
        <span class="collapsible-arrow">‚ñº</span>
    </div>
    <div class="collapsible-content">
       
        <div id="clienti-a-rischio-container" class="lista-clienti-rischio">
            <p class="loading">Caricamento in corso...</p>
        </div>
    </div>
</div>


<!-- PANNELLO MUSICA -->
<div class="panel dashboard-panel collapsible-panel closed">
    <div class="collapsible-header">
        <h2 class="panel-title">Musica</h2>
        <span class="collapsible-arrow">‚ñº</span>
    </div>
    <div class="collapsible-content">
        <div class="tools-grid" style="justify-content: flex-start;">
            <button id="play-radiofreccia" class="btn-music">üéµ Apri Radiofreccia</button>
            <button id="play-spotify" class="btn-music">üéß Apri Spotify</button>
            <button id="play-player" class="btn-music">üéπ Apri Player Musica</button>
        </div>
    </div>
</div>





    </div>
    <!-- ============================================= -->
	
<!-- MODALE PER LA MAPPA SALONE (CON DIMENSIONI CORRETTE) -->
<div id="mappa-salone-modal" class="dashboard-modal">
    <!-- Applico lo stile al contenitore principale -->
    <div class="dashboard-modal-content large" style="width: 95%; max-width: 1400px; height: 90vh;">
        
        <div class="dashboard-modal-header">
            <h3>Quality Hair Live</h3>
            <button id="close-mappa-btn" class="close-btn">&times;</button>
        </div>

        <!-- Rimuovo lo stile dal corpo e lascio che si adatti -->
        <div class="dashboard-modal-body" style="padding: 0; height: 800px;">
            <iframe id="mappa-iframe" src="about:blank" style="width: 100%; height: 100%; border: none;"></iframe>
        </div>

    </div>
</div>
	
	
	
</main>


<!-- ======================================================= -->
<!-- === NUOVA MODALE "PREPARA APPUNTAMENTO" === -->
<!-- ======================================================= -->
<div id="prepare-appointment-modal" class="modal">
    <div class="modal-content large-modal">
        
        <div class="prep-header">
            <img id="prep-avatar" src="/img/default-avatar.png" alt="Avatar Cliente" class="profile-avatar">
            <div class="prep-header-info">
                <h3 id="prep-client-name">Nome Cliente...</h3>
                <div id="prep-client-tags" class="tags-container"></div>
            </div>
            <button class="modal-button cancel" id="prep-close-btn" style="position: absolute; top: 15px; right: 15px;">&times;</button>
        </div>

        <hr class="panel-divider">

        <div class="prep-grid">
            <!-- Colonna Sinistra: Ultimo Lavoro -->
            <div class="prep-section">
                <h4>Ultimo Lavoro Eseguito</h4>
                <div id="prep-last-photo-container" class="prep-photo-container">
                    <p>Nessuna foto recente trovata.</p>
                </div>

            </div>

            <!-- Colonna Destra: Ultima Analisi -->
			<div id="prep-last-formula">
               <strong>Formula Colore:</strong>
               <p>Nessuna formula registrata.</p>
            </div>
			
            <div class="prep-section">
                <h4>Ultima Analisi Trico</h4>
                <div id="prep-last-analysis">
                    <p>Nessuna analisi trovata.</p>
                </div>
            </div>
        </div>

        <hr class="panel-divider">

        <!-- Azioni Rapide -->
        <div class="prep-actions">
            <a id="prep-full-card-btn" href="#" class="btn btn-primary">Apri Scheda Completa</a>
            <div class="contact-actions">
                <a id="prep-whatsapp-btn" class="contact-btn" title="Invia WhatsApp" style="display: none;">üí¨</a>
                <a id="prep-email-btn" class="contact-btn" title="Invia Email" style="display: none;">üìß</a>
            </div>
        </div>
    </div>
</div>



<!-- Modale Clienti in Sospeso -->
<div id="sospesiModal" class="dashboard-modal">
    <div class="dashboard-modal-content">
        <div class="dashboard-modal-header">
            <h3>Clienti con Pagamenti in Sospeso</h3>
            <button class="close-btn">&times;</button>
        </div>
        <div class="dashboard-modal-body">
            <table class="summary-table">
                <thead>
                    <tr>
                        <th>Cliente</th>
                        <th>Importo Sospeso</th>
                        <th>Azione</th>
                    </tr>
                </thead>
                <tbody id="sospesi-lista">
                    <!-- Il JS popoler√† questa tabella -->
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Modale Buoni Attivi -->
<div id="buoniModal" class="dashboard-modal">
    <div class="dashboard-modal-content">
        <div class="dashboard-modal-header">
            <h3>Buoni Regalo Attivi</h3>
            <button class="close-btn">&times;</button>
        </div>
        <div class="dashboard-modal-body" id="buoni-lista">
            <!-- Il JS popoler√† questa lista -->
        </div>
    </div>
</div>

<!-- ============================================= -->
<!-- === MODALE IMPOSTAZIONI E GESTIONE === -->
<!-- ============================================= -->
<div id="impostazioni-modal" class="dashboard-modal">
    <div class="dashboard-modal-content">
        <div class="dashboard-modal-header">
            <h3>Impostazioni e Gestione</h3>
            <button id="close-impostazioni-btn" class="close-btn">&times;</button>
        </div>
        <div class="dashboard-modal-body">
            <div class="tools-grid" style="text-align: center;">
                <!-- I PULSANTI SPOSTATI SONO ORA QUI -->
				<a href="/lista-clienti.html" class="btn btn-primary">Lista Clienti</a>
				<a href="/catalogo.html" class="btn btn-primary">Catalogo Lavori</a>
                <a href="/prodotti.html" class="btn btn-primary">Gestione Prodotti</a>
                <a href="/listino.html" class="btn btn-primary">Listino Prezzi</a>
				<a href="/analisi-statistiche.html" class="btn btn-primary">üìä Analisi e Statistiche</a>
                <hr class="panel-divider">
                <a href="/logout" class="btn btn-danger">Esci dal Programma</a>
            </div>
        </div>
    </div>
</div>

<script>
// =======================================================
// === GESTIONE MODALE IMPOSTAZIONI E GESTIONE ===
// =======================================================
document.addEventListener('DOMContentLoaded', () => {
    const impostazioniModal = document.getElementById('impostazioni-modal');
    const apriImpostazioniBtn = document.getElementById('apri-impostazioni-btn');
    const chiudiImpostazioniBtn = document.getElementById('close-impostazioni-btn');

    // --- Apertura ---
    function apriModaleImpostazioni() {
        impostazioniModal.style.display = 'block';
    }

    // --- Chiusura ---
    function chiudiModaleImpostazioni() {
        impostazioniModal.style.display = 'none';
    }

    // --- Click sul pulsante "Apri" ---
    if (apriImpostazioniBtn) {
        apriImpostazioniBtn.addEventListener('click', apriModaleImpostazioni);
    }

    // --- Click sulla "X" ---
    if (chiudiImpostazioniBtn) {
        chiudiImpostazioniBtn.addEventListener('click', chiudiModaleImpostazioni);
    }

    // --- Click fuori dal contenuto per chiudere ---
    window.addEventListener('click', function(event) {
        if (event.target === impostazioniModal) {
            chiudiModaleImpostazioni();
        }
    });

    // =======================================================
    // === APERTURA AUTOMATICA DA LINK ESTERNO ===
    // =======================================================
    const params = new URLSearchParams(window.location.search);
    const modalToOpen = params.get('openModal');

    if (modalToOpen === 'impostazioni') {
        console.log("DEBUG: apro modale impostazioni!");
        apriModaleImpostazioni();
        window.history.replaceState({}, document.title, window.location.pathname);
    }
});
</script>


    <script src="/js/dashboard-app.js"></script>
	
	
<script>
// =======================================================
// === ACCESSO SEGRETO AL PANNELLO CASSA - VERSIONE CORRETTA ===
// =======================================================
// VERSIONE PULITA senza alert di conferma
(function() {
    let keySequence = '';
    const secretCode = 'sesere';
    let isListening = true;

    document.addEventListener('keydown', function(e) {
        if (!isListening) return;
        
        if (e.ctrlKey || e.altKey || e.metaKey || e.key === 'Shift') {
            return;
        }

        if (e.key.length === 1 && e.key.match(/[a-z]/i)) {
            keySequence += e.key.toLowerCase();
            
            if (keySequence.length > secretCode.length) {
                keySequence = keySequence.slice(-secretCode.length);
            }
            
            console.log('Sequenza:', keySequence);
            
            if (keySequence === secretCode) {
                console.log('‚úÖ Codice segreto riconosciuto!');
                keySequence = '';
                isListening = false;
                
                setTimeout(() => {
                    const token = prompt('üîê ACCESSO PANNELLO SESERE\n\nInserisci il token di sicurezza:');
                    if (token && token.trim() !== '') {
                        sessionStorage.setItem('adminToken', token.trim());
                        
                        // APRI IL PANNELLO SENZA MESSAGGIO DI CONFERMA
                        window.open('/admin-pannello.html', '_blank');
                    } else {
                        alert('‚ùå Token non valido. Accesso negato.');
                    }
                    
                    setTimeout(() => {
                        isListening = true;
                    }, 2000);
                }, 100);
            }
        }
        
        if (e.key === 'Escape') {
            keySequence = '';
            console.log('Sequenza reset con ESC');
        }
    });

    
})();

(function() {
    let keySequence = '';
    const secretCode = 'sesere';
    let isListening = true;

    // === LISTENER DA TASTIERA (come prima) ===
    document.addEventListener('keydown', function(e) {
        if (!isListening) return;
        
        if (e.ctrlKey || e.altKey || e.metaKey || e.key === 'Shift') return;

        if (e.key.length === 1 && e.key.match(/[a-z]/i)) {
            keySequence += e.key.toLowerCase();
            
            if (keySequence.length > secretCode.length) {
                keySequence = keySequence.slice(-secretCode.length);
            }
            
            console.log('Sequenza:', keySequence);
            
            if (keySequence === secretCode) {
                console.log('‚úÖ Codice segreto riconosciuto!');
                apriPannello();
            }
        }
        
        if (e.key === 'Escape') {
            keySequence = '';
            console.log('Sequenza reset con ESC');
        }
    });

    // === FUNZIONE COMUNE PER L‚ÄôACCESSO ===
    function apriPannello() {
        keySequence = '';
        isListening = false;

        setTimeout(() => {
            const token = prompt('üîê ACCESSO PANNELLO SESERE\n\nInserisci il token di sicurezza:');
            if (token && token.trim() !== '') {
                sessionStorage.setItem('adminToken', token.trim());
                window.open('/admin-pannello.html', '_blank');
            } else {
                alert('‚ùå Token non valido. Accesso negato.');
            }

            setTimeout(() => {
                isListening = true;
            }, 2000);
        }, 100);
    }

    // === DOPPIO TAP su angolo destro inferiore ===
    let lastTap = 0;
    const secretZone = document.createElement('div');
    secretZone.id = 'secret-zone';
    secretZone.style.position = 'fixed';
    secretZone.style.bottom = '10px';
    secretZone.style.right = '10px';
    secretZone.style.width = '60px';
    secretZone.style.height = '60px';
    secretZone.style.background = 'transparent'; 
secretZone.style.border = 'none';
secretZone.style.borderRadius = '0';

    secretZone.style.zIndex = '9999';
    secretZone.style.backdropFilter = 'blur(2px)';
    document.body.appendChild(secretZone);

    secretZone.addEventListener('touchend', function() {
        const currentTime = new Date().getTime();
        const tapLength = currentTime - lastTap;

        if (tapLength < 300 && tapLength > 0) {
            console.log('üì± Doppio tap rilevato! Accesso segreto...');
            apriPannello();
        }

        lastTap = currentTime;
    });
})();



</script>

<script src="./js/dashboard-clienti.js"></script>
</body>
</html>


</body>
</html>